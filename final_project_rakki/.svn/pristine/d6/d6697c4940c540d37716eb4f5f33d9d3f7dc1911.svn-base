<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.rakki.mapper.SellBuyMapper">
	<select id="getBuyPriceList" resultType="priceList">
		SELECT PRODUCT_NO, SERIALNO,NAME_KO,NAME_EN,IMAGE, CATEGORY,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '230' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p230,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '235' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p235,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '240' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p240,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '245' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p245,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '250' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p250,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '255' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p255,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '260' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p260,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '265' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p265,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '270' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p270,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '275' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p275,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '280' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p280,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '285' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p285,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '290' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p290,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '295' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p295,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '300' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p300,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '305' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p305,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '310' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p310,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '315' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p315,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '315' AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p320,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'XS'  AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pXs,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'S'   AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pS,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'M'   AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pM,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'L'   AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pL,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'XL'  AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pXl
		FROM TBL_PRODUCT WHERE PRODUCT_NO = #{product_no}
	</select>
	
	<select id="getSellPriceList" resultType="priceList">
		SELECT PRODUCT_NO, SERIALNO,NAME_KO,NAME_EN,IMAGE, CATEGORY,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '230' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p230,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '235' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p235,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '240' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p240,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '245' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p245,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '250' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p250,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '255' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p255,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '260' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p260,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '265' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p265,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '270' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p270,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '275' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p275,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '280' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p280,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '285' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p285,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '290' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p290,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '295' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p295,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '300' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p300,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '305' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p305,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '310' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p310,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '315' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p315,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= '315' AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) p320,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'XS'  AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pXs,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'S'   AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pS,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'M'   AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pM,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'L'   AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pL,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= 'XL'  AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) pXl
		FROM TBL_PRODUCT WHERE PRODUCT_NO = #{product_no}
	</select>	
		
	<select id="getSellCheck" resultType="priceList">
		SELECT PRODUCT_NO, SERIALNO,NAME_KO,NAME_EN,IMAGE,CATEGORY FROM TBL_PRODUCT WHERE PRODUCT_NO = #{product_no}
	</select>	
		
	<select id="getSellConfirm" resultType="priceList">
		SELECT PRODUCT_NO, SERIALNO,NAME_KO,NAME_EN,IMAGE,CATEGORY,
		 (SELECT MIN(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= #{size_type} AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) buy_price,
		 (SELECT MAX(PRICE) FROM TBL_GOODS WHERE SIZE_TYPE= #{size_type} AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no}) sell_price		    
		FROM TBL_PRODUCT WHERE PRODUCT_NO = #{product_no}
	</select>
	
	<select id="getBuyGoodsNo" resultType="Long">
		SELECT MIN(GOODS_NO) FROM TBL_GOODS WHERE SIZE_TYPE= #{size_type} AND STATUS='0' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no} AND PRICE = #{sell_price} 
	</select>
	
	<select id="getSellerGoodsNo" resultType="Long">
		SELECT MIN(GOODS_NO) FROM TBL_GOODS WHERE SIZE_TYPE= #{size_type} AND STATUS='1' AND GOODS_STAT ='0' AND PRODUCT_NO = #{product_no} AND PRICE = #{buy_price} 
	</select>
	
	<select id="getNewGoodsNo" resultType="Long">
		SELECT SEQ_GOODS.NEXTVAL FROM DUAL 
	</select>
	
	<select id="getNewTradeNo" resultType="Long">
		SELECT SEQ_TRADE.NEXTVAL FROM DUAL 
	</select>
	
	<insert id="insertSellGoods" >	
		INSERT INTO TBL_GOODS (GOODS_NO,ID,PRODUCT_NO,SIZE_TYPE,PRICE,STATUS,REGDATE,GOODS_STAT,TRADENO) 
		VALUES (#{seller_goods_no},#{id},#{product_no},#{size_type},#{sell_price},'1',sysDate,#{goods_stat},#{tradeNo})
	</insert>
	
	<insert id="insertSellGoods_NullTradeNo" >	
		INSERT INTO TBL_GOODS (GOODS_NO,ID,PRODUCT_NO,SIZE_TYPE,PRICE,STATUS,REGDATE,GOODS_STAT) 
		VALUES (#{seller_goods_no},#{id},#{product_no},#{size_type},#{sell_price},'1',sysDate,#{goods_stat})
	</insert>
	
	<insert id="insertSellTrade" >
		INSERT INTO TBL_TRADE (TRADENO,SELLER_GOODS_NO,BUYER_GOODS_NO,PRODUCT_NO,TRADE_DATE,SELL_STAT,BUY_STAT)
		VALUES (#{tradeNo},#{seller_goods_no},#{buyer_goods_no},#{product_no},sysDate,'거래체결','거래체결')			
	</insert>
	
	<update id="updateBuyGoods">
		UPDATE TBL_GOODS SET GOODS_STAT = #{goods_stat}, TRADENO = #{tradeNo} WHERE GOODS_NO = #{buyer_goods_no}	
	</update>
		
	<insert id="insertBuyTrade" >
		INSERT INTO TBL_TRADE (TRADENO,SELLER_GOODS_NO,BUYER_GOODS_NO,PRODUCT_NO,TRADE_DATE,SELL_STAT,BUY_STAT)
		VALUES (#{tradeNo},#{seller_goods_no},#{buyer_goods_no},#{product_no},sysDate,'거래체결','거래체결')			
	</insert>
	
	<insert id="insertBuyGoods" >	
		INSERT INTO TBL_GOODS (GOODS_NO,ID,PRODUCT_NO,SIZE_TYPE,PRICE,STATUS,REGDATE,GOODS_STAT,TRADENO) 
		VALUES (#{buyer_goods_no},#{id},#{product_no},#{size_type},#{buy_price},'0',sysDate,#{goods_stat},#{tradeNo})
	</insert>
	
	<update id="updateSellGoods">
		UPDATE TBL_GOODS SET GOODS_STAT = #{goods_stat}, TRADENO = #{tradeNo} WHERE GOODS_NO = #{seller_goods_no}	
	</update>
		
	<insert id="insertBuyGoods_NullTradeNo" >	
		INSERT INTO TBL_GOODS (GOODS_NO,ID,PRODUCT_NO,SIZE_TYPE,PRICE,STATUS,REGDATE,GOODS_STAT) 
		VALUES (#{buyer_goods_no},#{id},#{product_no},#{size_type},#{buy_price},'0',sysDate,#{goods_stat})
	</insert>
	
		
</mapper>